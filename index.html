<!DOCTYPE html>
<html lang="en">

  <head>

    <style>
        #mapid{
            float: left;
            width: 100%;
            height: 100%;
            top: 0px;
            left: 0px;
        }

        #loader{
            position: fixed;
            width: 100%;
            height: 100%;
            background: rgba(1, 1, 1, 0.5);
            text-align: center;
            color: white;
            padding-top: 100px;
        }
        td{
            padding: 10px 0px;
        }
    </style>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Signal Danger</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/the-big-picture.css" rel="stylesheet">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
  integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
  crossorigin=""/>

    <link rel = "stylesheet" href = "https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css"/>
    <link rel = "stylesheet" href = "https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.Default.css"/>

  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
crossorigin=""></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src = "https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script>
  </head>

  <body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-bottom">
      <div class="container">
        <a class="navbar-brand" href="#">Signal Danger</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
              <a class="nav-link" href="#">Home
                <span class="sr-only">(current)</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Services</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Page Content -->
    <section>
      <div class="container">
        <div class="row" style = "font-size: 0.7em; background: black;">
            <div class = "col-lg-9" style = "right: 0px; height: 100%; position: fixed;">
                <div id="mapid"></div>
            </div>
          <div class="col-lg-3" style = "background: white; height: 100%; position: fixed; left: 0px; ">
            <h1 class="mt-5">Signal Danger</h1>
            <p>
                The Signal Danger web app lets you visuallize the most dangerous traffic signals based on the number of pedestrian crashes that have occured (Data from Chapel Hill Open Data Portal).
            </p>
            <h3>Legend</h3>
            <table>
                <tr>
                    <td>
                        <img style = "padding-right:10px" src = "https://cdn4.iconfinder.com/data/icons/logistics-and-delivery-vol-3/64/traffic-light-256.png" width = "30"/>
                    </td>
                    <td>
                        Traffic Signal
                    </td>
                    <td style="padding-left: 10px">
                        <img style = "padding-right:10px" src = "https://cartofy.com/wp-content/uploads/2016/10/map-marker-2-xxl.png" width = "30"/>
                    </td>
                    <td>
                        Pedestrian Crash
                    </td>
                </tr>
                <tr>
                    <td>
                        <img style = "padding-right:10px" src = "https://francescamarcenaro.com/wp-content/uploads/2017/06/map-marker-2-xxl.png" width = "30"/>
                    </td>
                    <td>
                        Bike Crash
                    </td>
                </tr>
            </table>

            <h3>Instructions</h3>
            <p>
                Use the mouse and scroll wheel to navigate the map. Double click on a cluster to zoom into it. Single click on cluster to see makers within it.
            </p>
          </div>
        </div>
      </div>
    </section>

    <div id = "loader">
        Loading. Please wait.
    </div>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <script>
    setTimeout(function(){
        $('#loader').fadeOut();
    }, 2500);
        var mymap = L.map('mapid').setView([51.505, -0.09], 13);
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiYnNocmVzdGhhIiwiYSI6ImNqZjhpenY0bTI3azAzM2xub2I1MjdicHIifQ.Dsgfne2MuQyz9gocq7A8NA', {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: 'your.mapbox.access.token'
        }).addTo(mymap);

    // var circle = L.circle([51.508, -0.11], {
    //     color: 'red',
    //     fillColor: '#f03',
    //     fillOpacity: 0.5,
    //     radius: 500
    // }).addTo(mymap);

    var greenIcon = L.icon({
        iconUrl: 'https://cdn4.iconfinder.com/data/icons/logistics-and-delivery-vol-3/64/traffic-light-256.png',

        iconSize:     [20, 20]
    });

    var picon = L.icon({
        iconUrl: 'https://cartofy.com/wp-content/uploads/2016/10/map-marker-2-xxl.png',
        iconSize: [20, 20]
    });

    var gicon = L.icon({
        iconUrl: 'https://francescamarcenaro.com/wp-content/uploads/2017/06/map-marker-2-xxl.png',
        iconSize: [20, 20]
    });

    $.getJSON("https://www.chapelhillopendata.org/api/records/1.0/search/?dataset=traffic-signals-in-chapel-hill&rows=1000", function(result){
        var markers = [];
        $.each(result.records, function(i, field){
            point = result.records[i].fields.geo_point;
            var marker = L.marker(point, {icon: greenIcon}).setOpacity(1.0).addTo(mymap);
            markers.push(marker);
        });
        var group = new L.featureGroup(markers);
        mymap.fitBounds(group.getBounds());
    });

    $.getJSON("https://www.chapelhillopendata.org/api/records/1.0/search/?dataset=pedestrian-crashes-chapel-hill-region&rows=1000&facet=ambulancer&facet=city&facet=county&facet=crashalcoh&facet=crashday&facet=crash_grp&facet=crash_loc&facet=crash_type&facet=crsh_sevri&facet=developmen&facet=drvrage_gr", function(result){
        var markers = L.markerClusterGroup();
        var markersi = []
        console.log(result);
        $.each(result.records, function(i, field){
            point = result.records[i].fields.geo_point_2d;
            var marker = L.marker(point, {icon: picon});
            markers.addLayer(marker);
            markersi.push(marker);
        });
        mymap.addLayer(markers);
        // var group = new L.featureGroup(markersi);
        // mymap.fitBounds(group.getBounds());
    });

    $.getJSON("https://www.chapelhillopendata.org/api/records/1.0/search/?dataset=bicycle-crash-data-chapel-hill-region&rows=1000&facet=ambulancer&facet=bikeage_gr&facet=bike_age&facet=bike_alc_d&facet=bike_dir&facet=bike_injur&facet=bike_pos&facet=bike_race&facet=bike_sex&facet=city&facet=county&facet=crashalcoh&facet=crashday&facet=crash_grp&facet=crash_hour&facet=crash_loc&facet=crash_mont&facet=crash_time&facet=crash_type&facet=crash_year&facet=crsh_sevri&facet=developmen&facet=drvrage_gr&facet=drvr_age&facet=drvr_alc_d&facet=drvr_estsp&facet=drvr_injur&facet=drvr_race&facet=drvr_sex&facet=drvr_vehty&facet=excsspdind&facet=hit_run&facet=light_cond&facet=locality&facet=num_lanes&facet=num_units&facet=rd_charact&facet=rd_class&facet=rd_conditi&facet=rd_config&facet=rd_defects&facet=rd_feature&facet=rd_surface&facet=rural_urba&facet=speed_limi&facet=traff_cntr&facet=weather&facet=workzone_i&facet=bike_unitn&facet=drvr_unitn&facet=on_rd", function(result){
        var markers = L.markerClusterGroup();
        var markersi = []
        console.log(result);
        $.each(result.records, function(i, field){
            point = result.records[i].fields.geo_point_2d;
            var marker = L.marker(point, {icon: gicon});
            markers.addLayer(marker);
            markersi.push(marker);
        });
        mymap.addLayer(markers);
        // var group = new L.featureGroup(markersi);
        // mymap.fitBounds(group.getBounds());
    });
    </script>

  </body>

</html>
